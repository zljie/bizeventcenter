# 企业中间件业务事件中心 原型说明书

## 1.1 文档目的
- 说明系统原型的业务范围、页面对象与操作方式，作为产品评审与实现依据
- 期望读者：产品经理、系统架构师、前端与后端开发工程师、测试工程师、实施与运维工程师

## 1.2 文档内容
- 模块与页面概览、核心流程说明
- 典型页面的对象拆解与操作说明（列表/新增/编辑表单）
- 设计规范与风格说明（无视觉设计，仅内容规范）
- 资源与数据设计（数据源、接口约定、存储与路由）

## 1.3 参考文档
- 系统操作说明：`docs/system-operations.md`
- API 接口约定：`docs/api.md`
- POC 方案报告：`event-center-poc-solution.md`
- 项目交付文档：`项目交付文档.md`
- 项目概述与快速开始：`README.md`

## 1.4 术语表（表1-1）
| 名称/缩写 | 英文全称 | 中文解释 |
|---|---|---|
| 消息主题 | Message Topic | 业务消息的主题定义，作为事件设计与订阅的上层抽象 |
| 主题版本 | Topic Version | 消息主题的版本标识，用于解耦事件与主题并支持版本管理 |
| 事件 | Event | 业务系统中发生的可发布与可订阅的事项 |
| 模板 | Template | 标准化事件的结构定义与示例，用于快速创建事件 |
| 消息登记 | Message Registration | 基于主题/模板登记消息的表单流程与保存逻辑 |
| 发布中心 | Event Publish Center | 事件管理模块，支持列表、筛选、批量与新增/编辑 |
| 订阅中心 | Subscription Center | 订阅关系的创建、管理与监控 |
| 事件ID | Event ID | 事件唯一标识，用于路由与订阅绑定 |
| 业务域 | Business Domain | 事件所属业务域，便于分类与筛选 |
| 载荷 | Payload | 事件数据内容，遵循约定的结构定义 |

---

## 1. 设计规范
- 一致性：字段命名与术语统一（“消息主题登记”替代“消息主体登记”）
- 可发现：关键操作置于页面显著位置（新增、批量操作、详情、登记入口）
- 反馈与可撤销：保存/删除/批量操作均有提示，删除有二次确认
- 校验规则：
  - 表单必填项校验（事件ID/名称/状态/主题等）
  - JSON 字段需严格校验并给出错误提示（消息登记的数据结构）
- 可访问性：输入框、选择器支持键盘操作；颜色标签提供状态/分类信息
- 安全与隐私：避免在前端日志中输出敏感字段；生产环境需通过 API 鉴权与角色权限控制

## 2. 风格设计
- 布局：左侧导航 + 右侧内容区；页头含面包屑与系统名称；各模块采用卡片分区
- 色彩（业务化配色）：
  - 主色：#1890ff（高频操作与强调）
  - 辅色：#52c41a（成功/验收）
  - 警示：#ff4d4f（删除/错误）
  - 文本：#1f2328，背景：#f7f9fc，分隔线：#e5e7eb
- 组件：列表（表格 + 标签）、表单（输入/选择/校验）、弹窗（详情与需求）、按钮（主要/次要/危险）、徽标（状态）

## 3. 典型页面
- 仪表板（主页面）：指标卡、最近日志、活跃事件
- 消息主题登记：行业模板库浏览与详情、消息登记入口
- 事件发布中心：事件列表、筛选与批量操作，新增/编辑表单（含主题绑定）
- 事件订阅中心：订阅列表与统计，新建/编辑订阅表单
- 业务事件日志：日志列表与筛选，详情载荷查看
- 消息登记：表单登记并保存，返回主题页

## 4.1 主页面（仪表板）
- 视图元素
  - 指标卡：已发布事件数/总订阅数/今日触发/成功率
  - 最近事件日志：表格展示（名称、时间、状态、订阅者、成功/失败推送、处理时间）
  - 活跃事件：已发布事件的概览（名称、分类、订阅数、最后触发）
- 操作方式
  - 点击“查看全部”进入日志或事件列表页
  - 可在页面右上角打开“需求说明”以快速了解模块目标

## 4.2 子页面1（消息主题登记）
- 列表与筛选
  - 搜索：按事件名称/ID/描述模糊搜索
  - 分类筛选：业务分类（生产/采购/销售/库存/安全）
  - 子分类标签：显示分类下各子类模板数量
- 列表字段
  - 事件ID、事件名称、业务分类（彩色标签）、子分类、业务域、优先级（彩色标签）、描述、操作（详情）
- 详情弹窗
  - 展示模板属性、触发条件、使用场景、数据结构（JSON）
  - 关联模板集合：显示与该主题关联的自定义模板标识（用于版本化与复用）
  - 操作：
    - 消息登记：跳转消息登记表单并预填 `topic/eventId/eventName`
    - 使用此模板：提示创建事件配置（POC）
- 新增入口
  - 页面右上角按钮“消息登记”：进入消息登记表单流程

## 4.3 子页面2（事件发布中心）
- 列表与筛选
  - 搜索：事件名称/ID/分类
  - 状态筛选：全部/草稿/已发布/已停用
  - 批量操作：发布/停用/删除（勾选行后可用）
- 列表字段
  - 事件ID、事件名称、分类（彩色标签）、状态（彩色标签）、发布者、订阅数、发布时间、最后触发、消息主题（名称 + 版本标签）、操作（详情/编辑/删除）
- 新增/编辑表单字段
  - 消息主题（下拉必选，来自主题数据或模板去重生成）
  - 主题版本（文本，选填）
  - 事件ID、事件名称、分类（生产/安全/库存/采购/销售）、描述、状态（草稿/已发布/已停用）、发布者
- 操作方式
  - 新增：点击“新增事件”，填写并保存，插入列表顶部
  - 编辑：在操作列点击“编辑”，更新并保存
  - 批量：选择多行后执行批量发布/停用/删除，提供反馈与确认

## 4.4 子页面3（事件订阅中心）
- 指标卡：正常/暂停订阅数量，总成功推送，总失败推送
- 列表与筛选
  - 搜索：事件名称/订阅者/事件ID
  - 状态筛选：全部/正常/暂停/异常
- 列表字段
  - 订阅者（固定左列）、事件名称、事件ID、状态（徽标）、推送方式、端点地址、过滤条件、成功次数、失败次数、订阅时间、操作（编辑/删除）
- 新增/编辑表单字段
  - 订阅者名称、事件ID、事件名称、推送方式（Webhook/HTTP API/队列/邮件）、端点地址、过滤条件、重试策略、状态

## 4.5 子页面4（消息登记）
- 表单字段
  - 消息主题（必填）、事件ID（必填）、事件名称（必填）
  - 推送方式（Webhook/HTTP API/消息队列/邮件）
  - 端点地址（必填）、描述、数据结构（JSON）
- 操作方式
  - 提交保存后写入本地存储 `localStorage.messageRegistrations`，并返回消息主题登记页面

## 4. 资源设计
- 数据源（POC）
  - 事件模板：`public/data/event-templates.json`
  - 已发布事件：`public/data/published-events.json`
  - 订阅关系：`public/data/subscriptions.json`
  - 事件日志：`public/data/event-logs.json`
  - 消息主题：`public/data/message-topics.json`（若不存在则从模板名称去重生成）
- 前端存储
  - `localStorage.customTemplates`：自定义模板集合
  - `localStorage.messageRegistrations`：消息登记记录集合
- 路由
  - `/dashboard`、`/subjects`、`/events`、`/subscriptions`、`/logs`、`/settings`、`/requirements`、`/message/register`
- 接口约定（拟）
  - 主题、模板、消息登记、事件、订阅等 RESTful 资源，详见 `docs/api.md`
- 迁移脚本（拟）
  - `db/migrations/001_create_tables.sql`：`message_topics`、`templates`、`message_registrations`
- 权限与角色（拟）
  - 管理员：事件/主题/订阅的增删改；观察员：只读；发布者：事件发布与停用；订阅者：订阅配置

---

## 附：核心流程
- 流程A（主题到消息登记）：主题页 → 查看详情 → 消息登记 → 保存 → 返回主题页
- 流程B（事件到订阅）：事件页 → 新增事件（绑定消息主题） → 保存 → 订阅页 → 新增订阅
- 流程C（总纲到模块页）：`/requirements` → 选择模块/功能 → 查看功能页面

